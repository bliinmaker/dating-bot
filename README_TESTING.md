# Тестирование Dating Bot

## Запуск тестов

### Локальный запуск
```bash
# Установка зависимостей
pip install -r requirements.txt

# Запуск всех тестов
pytest tests/ -v

# Запуск с покрытием кода
pytest tests/ -v --cov=. --cov-report=html --cov-report=term-missing
```

### Через Docker
```bash
# Запуск тестов в контейнере
docker-compose run --rm bot python -m pytest tests/ -v --cov=.
```

### Простой запуск
```bash
python3 run_tests.py
```

## Структура тестов

### test_user_service.py
- Тестирование создания/получения пользователей
- Тестирование получения профилей пользователей
- Критический бизнес-функционал регистрации

### test_profile_service.py  
- Тестирование создания профилей
- Тестирование валидации данных профиля
- Тестирование расчета полноты профиля

### test_api.py
- Тестирование REST API endpoints
- Тестирование HTTP статус кодов
- Тестирование валидации API

### test_models.py
- Тестирование моделей SQLAlchemy
- Тестирование связей между таблицами
- Тестирование ограничений БД

## Покрытие кода

Цель: **минимум 40% покрытия** критического бизнес-функционала

### Покрываемые модули:
- ✅ user_service.py - сервис управления пользователями
- ✅ profile_service.py - сервис управления профилями  
- ✅ models.py - модели данных
- ✅ api_server.py - REST API endpoints

### Критический функционал:
1. **Регистрация пользователей** - создание/получение пользователей Telegram
2. **Создание профилей** - анкеты для знакомств
3. **API функциональность** - REST endpoints для внешнего доступа
4. **Модели данных** - корректность работы с БД

## Файлы конфигурации

### pytest.ini
Конфигурация pytest с настройками покрытия кода

### conftest.py
Общие фикстуры для тестов:
- Тестовая база данных (SQLite)
- Сессия БД для тестов
- Тестовые данные (пользователи, профили)

## Миграции БД для тестов

Тесты используют SQLite в памяти для изоляции и скорости.
Продакшн использует PostgreSQL через миграции Alembic.

## Интеграция с CI/CD

Тесты готовы для запуска в CI/CD pipeline:
```yaml
# Пример для GitHub Actions
- name: Run tests
  run: |
    pip install -r requirements.txt
    pytest tests/ -v --cov=. --cov-report=xml
```